#!/usr/bin/env ruby
# rubocop:disable Metrics/CyclomaticComplexity, Layout/LineLength, Metrics/MethodLength
require_relative '../lib/board'
require_relative '../lib/player'

def p_name(p1, p2)
  puts 'Player 1, please enter your name'
  p1.name = gets.chomp
  puts 'Player 2, please enter your name'
  p2.name = gets.chomp
  puts "Let's start #{p1.name} and #{p2.name}"
end

def p_xo(p1, p2)
  puts "#{p1.name}, X or O?"
  validate_xo_switch = true
  while validate_xo_switch
    p1.choice = gets.chomp.upcase
    if p1.choice == 'X' || p1.choice == 'O'
      validate_xo_switch = false
    else
      puts 'Choose either X or O'
    end
    break if validate_xo_switch == false
  end
  p2.choice = 'O' if p1.choice == 'X'
  p2.choice = 'X' if p1.choice == 'O'
  puts "#{p1.name} is #{p1.choice}, #{p2.name} is #{p2.choice}"
end

def board_check(new_board)
  switch2 = false
  until switch2
    begin
      position = Integer(gets.chomp)
    rescue StandardError
      puts 'Provide a valid integer'
      retry
    end
    switch2 = true if position < 10 && new_board.player_move(position) == ' '
    puts 'Square already taken or does not exist.' if position > 9 || new_board.player_move(position) != ' '
  end
  position
end

def start(board_new, p1, p2)
puts '╔═══╦═══╦═══╗'
puts '║ 1 ║ 2 ║ 3 ║'
puts '╠═══╬═══╬═══╣'
puts '║ 4 ║ 5 ║ 6 ║'
puts '╠═══╬═══╬═══╣'
puts '║ 7 ║ 8 ║ 9 ║'
puts '╚═══╩═══╩═══╝'
puts 'Instructions : Enter a number from 1 to 9 to use one of the boxes.'
puts board_new.show_board
switch = true
while switch
  puts "#{p1.name}'s turn : "
  pos = board_check(board_new)
  puts board_new.player_move_update(pos, p1.choice)
  if board_new.check_win(p1.choice)
    puts "#{p1.name} You win!"
    break
  end
  if board_new.moves == 9
    puts 'DRAW !'
    break
  end
  puts "#{p2.name}'s turn : "
  pos = board_check(board_new)
  puts board_new.player_move_update(pos, p2.choice)
  if board_new.check_win(p2.choice)
    puts "#{p2.name} You win!"
    break
  end
  if board_new.moves == 9
    puts 'DRAW !'
    break
  end
end
end

puts 'Tic-Tac-Toe : Terminal Edition'


p1 = Player.new
p2 = Player.new
p_name(p1, p2)
p_xo(p1, p2)

board_new = Board.new

start(board_new, p1, p2)

# rubocop:enable Metrics/CyclomaticComplexity, Layout/LineLength, Metrics/MethodLength